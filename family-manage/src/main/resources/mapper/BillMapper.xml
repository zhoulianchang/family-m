<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zlc.family.manage.mapper.BillMapper">

    <select id="selectBillList" resultType="com.zlc.family.manage.vo.BillVo">
        SELECT
            bill_id,
            amount,
            user_name,
            type,
            flow,
            pay_time,
            remark
        FROM
            family_bill
        WHERE del_flag = 0
        <if test="query.userName != null and query.userName !=''">
            AND user_name = #{query.userName}
        </if>
        <if test="query.type != null">
            AND type = #{query.type}
        </if>
        <if test="query.flow != null">
            AND flow = #{query.flow}
        </if>
        <if test="query.params.beginTime != null and query.params.beginTime != ''"><!-- 开始时间检索 -->
            and pay_time &gt;= #{query.params.beginTime}
        </if>
        <if test="query.params.endTime != null and query.params.endTime != ''"><!-- 结束时间检索 -->
            and pay_time &lt;= concat(#{query.params.endTime},' 23:59:59')
        </if>
    </select>
    <select id="statsByFlow" resultType="com.zlc.family.manage.vo.BillStatsVo">
        SELECT
            t1.flow,
            sum( t1.amount ) as amount
        FROM
            family_bill t1
        WHERE del_flag = 0
            <if test="query!=null">
                <if test="query.userName != null and query.userName !=''">
                    AND t1.user_name = #{query.userName}
                </if>
                <if test="query.type != null">
                    AND t1.type = #{query.type}
                </if>
                <if test="query.flow != null">
                    AND t1.flow = #{query.flow}
                </if>
                <if test="query.params.beginTime != null and query.params.beginTime != ''"><!-- 开始时间检索 -->
                    and t1.pay_time &gt;= #{query.params.beginTime}
                </if>
                <if test="query.params.endTime != null and query.params.endTime != ''"><!-- 结束时间检索 -->
                    and t1.pay_time &lt;= concat(#{query.params.endTime},' 23:59:59')
                </if>
            </if>
        GROUP BY
            flow
    </select>
    <select id="statsByType" resultType="com.zlc.family.manage.domain.Bill">
        SELECT
            type,
            SUM( amount ) AS amount
        FROM
            family_bill
        WHERE del_flag = 0
        <if test="query!=null">
            <if test="query.params.beginTime != null and query.params.beginTime != ''"><!-- 开始时间检索 -->
                and pay_time &gt;= #{query.params.beginTime}
            </if>
            <if test="query.params.endTime != null and query.params.endTime != ''"><!-- 结束时间检索 -->
                and pay_time &lt;= concat(#{query.params.endTime},' 23:59:59')
            </if>
        </if>
        GROUP BY
            type
    </select>
</mapper>
