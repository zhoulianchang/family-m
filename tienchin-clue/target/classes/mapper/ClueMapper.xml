<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zlc.tienchin.clue.mapper.ClueMapper">

    <select id="selectClueList" resultType="com.zlc.tienchin.clue.vo.ClueVo">
        SELECT
            t1.clue_id,
            t1.`name`,
            t1.phone,
            t1.next_time,
            t1.`status`,
            t1.create_by,
            t1.create_time,
            t2.channel_name,
            t3.user_name AS `owner`
        FROM
            tienchin_clue t1
                LEFT JOIN tienchin_channel t2 ON t1.channel_id = t2.channel_id
                LEFT JOIN tienchin_assignment t3 ON t1.clue_id = t3.assign_id
                AND t3.latest = true
                AND t3.type = 1
        <where>
            <if test="query.nameLike != null and query.nameLike != ''">
                AND t1.`name` like CONCAT('%',#{query.nameLike},'%')
            </if>
            <if test="query.phoneLike != null and query.phoneLike != ''">
                AND t1.`phone` like CONCAT('%',#{query.phoneLike},'%')
            </if>
        </where>
    </select>
</mapper>
